<html>
    <head>
        <title>Simple Pomodoro</title>
        <link rel="stylesheet" href="style.css" />
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet"> 
    </head>
    <body>
        <div id="clock">
            <h1 class="stroke">Simple Pomodoro</h1>
            <time id="timer" class="stroke">25:00</time>
            <div>
                <button onClick="startPomo()">Start</button>
                <button onClick="resetTimer()">Reset</button>
                <button onClick="startShortBreak()">Take short break</button>
                <button onClick="startLongBreak()">Take long break</button>
            </div>
        </div>
        <script>
            var timer;
            var currTime;
            var endTime;
            const pomoMinutes = 25;
            const shortBreakMinutes = 5;
            const longBreakMinutes = 15;
            const msInMin = 60000;

            function startPomo() {
                startTimer(pomoMinutes);
            };

            function startShortBreak() {
                startTimer(shortBreakMinutes);
            };

            function startLongBreak() {
                startTimer(longBreakMinutes);
            };

            function startTimer(durationMinutes) {
                // Stop any existing timers
                resetTimer();

                currTime = new Date();
                endTime = new Date(currTime.getTime() + durationMinutes * msInMin);
                timer = setInterval(updateTimer, 500, endTime);
            };

            function resetTimer() {
                window.clearInterval(timer);
                document.getElementById("timer").innerHTML = "25:00";
            };
            
            function updateTimer(endTime) {
                currTime = new Date();
                diff = endTime - currTime;

                if (diff <= 0)
                {
                    playCompleteSound();
                    resetTimer();
                } else {
                    updateTimeDisplay(diff);
                }
            }

            function updateTimeDisplay(diff) {
                displayDate = new Date(diff);
                var minutes = displayDate.getMinutes();
                var seconds = displayDate.getSeconds();
                if (seconds < 10) {
                    seconds = "0" + seconds;
                }
                document.getElementById("timer").innerHTML = minutes + ":" + seconds;
            };

            function playCompleteSound() {
                new Audio("sounds/alarm.ogg").play()
            }
        </script>
    </body>
</html>
